{"version":3,"file":"757.bundle.1.0.10.js","mappings":"8JASO,SAASA,IACZ,KAII,QACI,6BACAC,EACAC,EACAC,GACA,EAER,CAAE,MAAOC,GAEL,KAAQA,MAAM,CACVC,QAAS,+CAAiDD,EAAMC,QAChEC,UAAW,+CACXC,MAAO,CAAC,GAEhB,CACJ,CAQA,SAASN,EAAkBO,GACvB,MAAMC,EAAkB,IAAIC,SAE5B,OADAD,EAAgBE,OAAO,QAASH,EAASI,IAAI,gCACtCH,CACX,CAQAI,eAAeX,EAAeY,GAC1B,MAAMC,EAAQD,EAAcF,IAAI,SAIhC,IADmB,kDACHI,KAAKD,GACjB,MAAO,CAAEE,SAAS,EAAOZ,QAAS,yCAGtC,IAEI,MAAMa,QAAiB,IAAAC,sBAAqBJ,EAAO,qBAAsB,kDAGzE,GAAIG,EAASb,QAAQY,QAMjB,OALA,KAAQG,KAAK,CACTf,QAAS,iDAAmDU,EAC5DT,UAAW,+BACXC,MAAO,CAAC,IAEL,CAAEU,SAAS,EAAMZ,QAAS,8CAC9B,CACH,MAAMgB,EAAeH,EAASb,SAAW,6DAMzC,OALA,KAAQD,MAAM,CACVC,QAAS,6CAA6CU,MAAUM,IAChEf,UAAW,iCACXC,MAAO,CAAC,IAEL,CAAEU,SAAS,EAAOZ,QAASgB,EACtC,CACJ,CAAE,MAAOjB,GAML,OALA,KAAQA,MAAM,CACVC,QAAS,qEAAqEU,MAAUX,EAAMC,UAC9FC,UAAW,wCACXC,MAAO,CAAC,IAEL,CAAEU,SAAS,EAAOZ,QAASD,EAAMC,SAAW,uEACvD,CACJ,CASAQ,eAAeV,EAAee,GAE1B,MAAMI,EAAcC,SAASC,eAAe,8BACtCC,EAAaH,EAAcA,EAAYI,WAAWC,cAAc,yBAA2B,KAG7FT,EAASD,SAAWK,GAAeG,IACnCH,EAAYM,UAAUC,IAAI,QAC1BJ,EAAWK,MAAMC,QAAU,QAEnC,C","sources":["webpack://worldify/./src/modules/pages/account/send_email_verification_link.js"],"sourcesContent":["import { setCookie, TOKEN_KEY, sendVerificationMail, checkAuthentication } from \"../../auth\";\nimport { setupForm } from \"../../form_handling\";\nimport { logging } from \"../../utils\";\n\n\n/**\n * Initializes and renders the functionality for resending an email verification link.\n * This function sets up the form used for requesting email verification.\n */\nexport function render() {\n    try {\n        // The setupForm function configures the form behavior,\n        // including transforming form data, submitting it, and handling the response.\n        // This is specifically tailored for the email verification process.\n        setupForm(\n            'sendEmailVerification_form', // ID of the form to be setup\n            transformFormData,            // Function to transform the form data\n            submitFormData,               // Function to submit the form data\n            handleResponse,               // Function to handle the response from submission\n            false                         // Indicates whether the success wrapper should automatically be shown\n        );\n    } catch (error) {\n        // Log any errors encountered during the email verification form setup\n        logging.error({\n            message: \"Error initializing email verification form: \" + error.message,\n            eventName: \"email_verification_form_initialization_error\",\n            extra: {} \n        });\n    }\n}\n\n/**\n * Transforms the form data for submission.\n * \n * @param {FormData} formData - The original form data.\n * @returns {FormData} - The transformed form data.\n */\nfunction transformFormData(formData) {\n    const transformedData = new FormData();\n    transformedData.append('email', formData.get('sendEmailVerification_email'));\n    return transformedData;\n}\n\n/**\n * Submits the email form data to the server to resend an email verification link.\n *\n * @param {FormData} formData - The transformed form data containing the user's email.\n * @returns {Promise<Object>} - The response data from the server.\n */\nasync function submitFormData(inputFormData) {\n    const email = inputFormData.get('email');\n\n    // Validate the format of the email address\n    const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,6}$/;\n    if (!emailRegex.test(email)) {\n        return { success: false, message: 'Please provide a valid email address.' };\n    }\n\n    try {\n        // Send the email verification link to the provided email address\n        const response = await sendVerificationMail(email, \"email_verification\", DOMAIN_URL + \"/account/onboarding\");\n\n        // Handle the response based on whether the email was successfully sent\n        if (response.message.success) {\n            logging.info({\n                message: \"Email verification link sent successfully to: \" + email,\n                eventName: \"email_verification_link_sent\",\n                extra: {}\n            });\n            return { success: true, message: \"Email verification link sent successfully.\" };\n        } else {\n            const errorMessage = response.message || 'Unknown error occurred while sending the verification link';\n            logging.error({\n                message: `Failed to send email verification link to ${email}: ${errorMessage}`,\n                eventName: \"email_verification_link_failed\",\n                extra: {}\n            });\n            return { success: false, message: errorMessage };\n        }\n    } catch (error) {\n        logging.error({\n            message: `Error during the email verification link sending process to email ${email}: ${error.message}`,\n            eventName: \"email_verification_link_sending_error\",\n            extra: {}\n        });\n        return { success: false, message: error.message || \"An error occurred during the email verification link sending process\" };\n    }\n}\n\n/**\n * Handles the response after submitting the email verification resend form.\n * This function updates the UI based on the server's response, indicating whether\n * the email verification link was successfully sent or not.\n * \n * @param {Object} response - The response object received from the form submission.\n */\nasync function handleResponse(response) {\n    // Access the form and its corresponding success message container\n    const formElement = document.getElementById('sendEmailVerification_form');\n    const successDiv = formElement ? formElement.parentNode.querySelector('[w-el=\"form_success\"]') : null;\n\n    // Display the success message and hide the form if the email verification link was sent successfully\n    if (response.success && formElement && successDiv) {\n        formElement.classList.add('hide'); // Hide the form\n        successDiv.style.display = 'block'; // Display the success message\n    }\n}"],"names":["render","transformFormData","submitFormData","handleResponse","error","message","eventName","extra","formData","transformedData","FormData","append","get","async","inputFormData","email","test","success","response","sendVerificationMail","info","errorMessage","formElement","document","getElementById","successDiv","parentNode","querySelector","classList","add","style","display"],"sourceRoot":""}